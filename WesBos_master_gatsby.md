# Notes on Master Gatsby

- Course by Wes Bos
- https://mastergatsby.com/


## Set up
- Like the "core concepts" sections at https://www.sanity.io/docs
- [Auto Rename Tag](https://marketplace.visualstudio.com/items?itemName=formulahendry.auto-rename-tag) is a handy VSCode extension

## Gatsby highlights
- As a __static site generator__, Gatsby generates pages _at build time_, not on page load in browser
  - HTML is already generated at deployment time via a build step
  - Not going page to page as much as signalling which prebuilt HTML to render and updating the URL to reflect the current app location
  - In contrast to an "on demand" site (e.g. WordPress), where URL slug is parsed, data pulled from database, template determined and HTML generated, and then data and template paired
  - A static site generator just does all that at build time instead of on demand
- Figures out __critical CSS__ and inlines it in a `style` tag so there's never the flash of unstyled content
- __Rehydration__: hooking React into prebuilt HTML, similar to SSR
  - Step 1: load prebuilt HTML
  - Step 2: update as needed via React
- __Lazy loading__ images
  - Image compression and file format (e.g. `.webp`)
- Built in __routing__ 
  - Observable in handling images on page load (deferred loading)
- Extensive __plugin ecosystem__
  - Similar to what people love about WordPress
- _Not_ a CMS
  - Need to set up own backend
- One trade off is that _dynamic pages_ need to be coded in a particular way

## Pages in Gatsby

- `public/` is generated by Gatsby
  - `gatsby clean` to blow out an regenerate
- Think twice before putting things in the `static/` folder
  - "Everything must go through Gatsby"
- Nice efficiency: __save-as__ to make a new file that's basically the same as a previous file
- Subtle naming-convention note: capitalized file names indicate a reusable component in React
  - These `page/` files are lowercase (like `index.js`) because they're not reusable

## Routing and Navigation
- `Link` component from Gatsby will use HTML5 push state
- For programmatic navigation (e.g. on form submit) `naviagte` method also exposed by Gatsby 

## Layouts in Gatsby
- `gatsby-browser.js` in root
  - `wrapPageElement`: can think of like a build step hook to add a layout (or any other "plugin" to page-level components)
- One of several browser APIs https://www.gatsbyjs.com/docs/browser-apis/
  - `shouldUpdateScroll`
  - `wrapRootElement`
  - `onRouteUpdate`
  - Several service worker related methods
- `gatsby-ssr.js` also needed to add this during server side rendering

## Global Styles
- If you included a CSS import in `gatsby-browser.js`, it would inject it as a critical CSS style tag in the production build
- Adding `normalize.css` import in `Layout`

```js
import bg from '../assets/images/bg.svg';
...
html {
    background-image: url(${bg});
}
```
- Gatsby facilitating this SVG import in `src/styles/GlobalStyles.js` 
  - This is "not JavaScript", as in an ESM couldn't import from an SVG like this
  - If this is a very small file, Gatsby will _convert the SVG asset into a base64 URL_, which saves a request for an image file
- If this is a standard file, any changes will result in a new, unique filename so the asset won't be cached 
  - Avoiding need to request hard refresh
  
```css
.gatsby-image-wrapper img[src*=base64\\,] {
    image-rendering: -moz-crisp-edges;
    image-rendering: pixelated;
  }
```
- In the prebuilt HTML, Gatsby includes images placeholders as a low res base64 string
  - This CSS will target that for the initial load
  - Once the image is retrieved from the server, this placeholder is replaced by the full-res version

- Includes cross-browser scroll bar styles

```css
html {
  ...
  font-size: 10px;
}
```
- He sets the base HTML to use `rem` units throughout
- `background-attachment` with differing values is fun 



## Typography

```js
import font from '../assets/fonts/frenchfries.woff';
```
- Gatsby will take this out of `assets/` and drop it into `static/` 

```js
export default function Layout({ children }) {
  return (
    <div>
      <GlobalStyles />
      <Typography />
```
- Including styles as React components is odd to me
  - He calls these "side effects"


## Styling Nav + Logo

```css
li {
  --rotate: -2deg;
  transform: rotate(var(--rotate));
  &:nth-child(1) {
    --rotate: 1deg;
}
```
- Declaring and then overriding a __CSS variable__ locally here is great
  - So much nicer than repeating the `transform` rule and all its other (unchanging) values

```js
<LogoStyles className="logo">
```
- Interesting Styled Components point: class is useful for targeting from other components (here `Nav`)

```css
const LogoStyles = styled.div`
  /* This value controls the entire size of the logo*/
  font-size: clamp(1px, 0.65vw, 8px);
  width: 30em;
  height: 30em;
  --borderSize: 1em;
```
- `clamp` here gives a min and max font size and allows the text to grow with the window within those bounds
- `em` units are then relative to the shared font size on the parent/container
  - Allows logo to be scaled up and down  
- Gatsby will add `aria-current="page"` to current nav links
  - Can be styled via `[aria-current="page"]{..}`

## Styling Layout

```css
margin: 12rem auto 4rem auto;
margin-top: clamp(2rem, 10vw, 12rem);
```
- `clamp` again used for responsive styles within bounds 
  - With fallback for nonsupporting browsers
